{% extends "base.html" %}

{% block title %}Heart Disease Prediction{% endblock %}

{% block extra_css %}
<style>
    .form-section {
        background: white;
        border-radius: 0.35rem;
        padding: 2rem;
        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
        margin-bottom: 2rem;
    }
    
    .input-group-text {
        background-color: var(--danger-color);
        color: white;
        border: none;
    }
    
    .info-icon {
        color: var(--danger-color);
        cursor: pointer;
        margin-left: 0.5rem;
    }
    
    .parameter-group {
        background-color: #f8f9fa;
        border-radius: 0.35rem;
        padding: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .parameter-group-title {
        color: var(--danger-color);
        font-weight: 600;
        margin-bottom: 1rem;
        border-bottom: 1px solid #dee2e6;
        padding-bottom: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="row animate-on-scroll">
    <div class="col-lg-12">
        <div class="card mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-white">Heart Disease Risk Assessment</h6>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    Please provide accurate information about your heart health for the most reliable prediction.
                </div>
                
                {% if show_result %}
                <div class="result-card card mb-4 animate__animated animate__fadeIn">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h4 class="mb-3">Prediction Result</h4>
                                <p class="lead">{{ result }}</p>
                                <div class="progress mt-3 mb-2">
                                    <div class="progress-bar bg-{{ 'danger' if 'has' in result else 'success' }}" 
                                         role="progressbar" 
                                         style="width: {{ confidence }}%" 
                                         aria-valuenow="{{ confidence }}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100">
                                    </div>
                                </div>
                                <p>Model confidence: {{ confidence }}%</p>
                                <p class="text-muted small">Analysis performed on {{ current_time }}</p>
                            </div>
                            <div class="col-md-4 text-center">
                                <i class="fas fa-{{ 'heartbeat' if 'has' in result else 'heart' }} fa-5x text-{{ 'danger' if 'has' in result else 'success' }} mb-3"></i>
                                <div>
                                    <a href="/heart" class="btn btn-outline-danger">New Assessment</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <div class="form-section">
                    <form method="POST" action="/heart" id="heartForm">
                        <h5 class="mb-4 text-danger">Personal Information</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="age" class="form-label">Age</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="age" name="age" min="1" max="120" required>
                                        <span class="input-group-text">yrs</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="sex" class="form-label">Sex</label>
                                    <select class="form-select" id="sex" name="sex" required>
                                        <option value="" selected disabled>Select your sex</option>
                                        <option value="0">Female</option>
                                        <option value="1">Male</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <hr class="my-4">
                        
                        <h5 class="mb-4 text-danger">Cardiac Parameters</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="cp" class="form-label">
                                        Chest Pain Type 
                                        <i class="fas fa-info-circle info-icon" data-bs-toggle="tooltip" title="Type of chest pain experienced"></i>
                                    </label>
                                    <select class="form-select" id="cp" name="cp" required>
                                        <option value="" selected disabled>Select chest pain type</option>
                                        <option value="0">Typical angina</option>
                                        <option value="1">Atypical angina</option>
                                        <option value="2">Non-anginal pain</option>
                                        <option value="3">Asymptomatic</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="trestbps" class="form-label">
                                        Resting Blood Pressure 
                                        <i class="fas fa-info-circle info-icon" data-bs-toggle="tooltip" title="In mm Hg on admission to hospital"></i>
                                    </label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="trestbps" name="trestbps" min="0" required>
                                        <span class="input-group-text">mm Hg</span>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="chol" class="form-label">
                                        Serum Cholesterol 
                                        <i class="fas fa-info-circle info-icon" data-bs-toggle="tooltip" title="In mg/dl"></i>
                                    </label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="chol" name="chol" min="0" required>
                                        <span class="input-group-text">mg/dl</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="fbs" class="form-label">
                                        Fasting Blood Sugar > 120 mg/dl
                                        <i class="fas fa-info-circle info-icon" data-bs-toggle="tooltip" title="Fasting blood sugar level"></i>
                                    </label>
                                    <select class="form-select" id="fbs" name="fbs" required>
                                        <option value="" selected disabled>Select option</option>
                                        <option value="0">No</option>
                                        <option value="1">Yes</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="restecg" class="form-label">
                                        Resting ECG Results 
                                        <i class="fas fa-info-circle info-icon" data-bs-toggle="tooltip" title="Resting electrocardiographic results"></i>
                                    </label>
                                    <select class="form-select" id="restecg" name="restecg" required>
                                        <option value="" selected disabled>Select ECG result</option>
                                        <option value="0">Normal</option>
                                        <option value="1">ST-T wave abnormality</option>
                                        <option value="2">Probable or definite left ventricular hypertrophy</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="thalach" class="form-label">
                                        Maximum Heart Rate Achieved 
                                        <i class="fas fa-info-circle info-icon" data-bs-toggle="tooltip" title="Highest heart rate during exercise"></i>
                                    </label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="thalach" name="thalach" min="0" required>
                                        <span class="input-group-text">bpm</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <h5 class="mb-4 text-danger mt-4">Exercise Parameters</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="exang" class="form-label">
                                        Exercise Induced Angina 
                                        <i class="fas fa-info-circle info-icon" data-bs-toggle="tooltip" title="Chest pain during exercise"></i>
                                    </label>
                                    <select class="form-select" id="exang" name="exang" required>
                                        <option value="" selected disabled>Select option</option>
                                        <option value="0">No</option>
                                        <option value="1">Yes</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="oldpeak" class="form-label">
                                        ST Depression Induced by Exercise 
                                        <i class="fas fa-info-circle info-icon" data-bs-toggle="tooltip" title="ST segment depression relative to rest"></i>
                                    </label>
                                    <input type="number" step="0.1" class="form-control" id="oldpeak" name="oldpeak" min="0" required>
                                </div>
                            </div>
                        </div>
                        
                        <h5 class="mb-4 text-danger">Advanced Parameters</h5>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="slope" class="form-label">
                                        Slope of Peak Exercise ST Segment 
                                        <i class="fas fa-info-circle info-icon" data-bs-toggle="tooltip" title="The slope of the peak exercise ST segment"></i>
                                    </label>
                                    <select class="form-select" id="slope" name="slope" required>
                                        <option value="" selected disabled>Select slope</option>
                                        <option value="0">Upsloping</option>
                                        <option value="1">Flat</option>
                                        <option value="2">Downsloping</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="ca" class="form-label">
                                        Number of Major Vessels 
                                        <i class="fas fa-info-circle info-icon" data-bs-toggle="tooltip" title="Number of major vessels colored by fluoroscopy"></i>
                                    </label>
                                    <select class="form-select" id="ca" name="ca" required>
                                        <option value="" selected disabled>Select number</option>
                                        <option value="0">0</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="thal" class="form-label">
                                        Thalassemia 
                                        <i class="fas fa-info-circle info-icon" data-bs-toggle="tooltip" title="A blood disorder called thalassemia"></i>
                                    </label>
                                    <select class="form-select" id="thal" name="thal" required>
                                        <option value="" selected disabled>Select type</option>
                                        <option value="0">Normal</option>
                                        <option value="1">Fixed defect</option>
                                        <option value="2">Reversible defect</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                            <button type="reset" class="btn btn-outline-secondary me-md-2">Reset</button>
                            <button type="submit" class="btn btn-danger">
                                <i class="fas fa-heartbeat me-1"></i> Assess Heart Health
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="card border-left-danger mb-4">
                    <div class="card-body">
                        <h5 class="card-title text-danger">
                            <i class="fas fa-heart me-2"></i> Understanding Heart Disease Risk
                        </h5>
                        <p class="card-text">
                            Our heart disease prediction model evaluates multiple cardiac parameters to assess your risk. 
                            A positive result suggests you may be at risk and should consult a cardiologist. 
                            Remember that risk factors can be modified through lifestyle changes and medical treatment.
                        </p>
                        <a href="#" class="btn btn-outline-danger btn-sm">Learn about heart health</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function() {
        // Initialize tooltips
        $('[data-bs-toggle="tooltip"]').tooltip();
        
        // Form validation
        $('#heartForm').on('submit', function() {
            let isValid = true;
            $(this).find('select[required]').each(function() {
                if (!$(this).val()) {
                    isValid = false;
                    $(this).addClass('is-invalid');
                } else {
                    $(this).removeClass('is-invalid');
                }
            });
            
            $(this).find('input[required]').each(function() {
                if (!$(this).val()) {
                    isValid = false;
                    $(this).addClass('is-invalid');
                } else {
                    $(this).removeClass('is-invalid');
                }
            });
            
            if (!isValid) {
                $('html, body').animate({
                    scrollTop: $('.is-invalid').first().offset().top - 100
                }, 500);
                return false;
            }
            return true;
        });
    });
</script>
{% endblock %}