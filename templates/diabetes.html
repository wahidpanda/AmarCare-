{% extends "base.html" %}

{% block title %}Diabetes Prediction{% endblock %}

{% block extra_css %}
<style>
    .form-section {
        background: white;
        border-radius: 0.35rem;
        padding: 2rem;
        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
        margin-bottom: 2rem;
    }
    
    .input-group-text {
        background-color: var(--primary-color);
        color: white;
        border: none;
    }
    
    .info-icon {
        color: var(--primary-color);
        cursor: pointer;
        margin-left: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="row animate-on-scroll">
    <div class="col-lg-12">
        <div class="card mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-white">Diabetes Risk Assessment</h6>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    Please fill in all fields with your current health metrics for an accurate prediction.
                </div>
                
                {% if show_result %}
                <div class="result-card card mb-4 animate__animated animate__fadeIn">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h4 class="mb-3">Prediction Result</h4>
                                <p class="lead">{{ result }}</p>
                                <div class="progress mt-3 mb-2">
                                    <div class="progress-bar bg-{{ 'danger' if 'has' in result else 'success' }}" 
                                         role="progressbar" 
                                         style="width: {{ confidence }}%" 
                                         aria-valuenow="{{ confidence }}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100">
                                    </div>
                                </div>
                                <p>Model confidence: {{ confidence }}%</p>
                                <p class="text-muted small">Analysis performed on {{ current_time }}</p>
                            </div>
                            <div class="col-md-4 text-center">
                                <i class="fas fa-{{ 'exclamation-triangle' if 'has' in result else 'check-circle' }} fa-5x text-{{ 'danger' if 'has' in result else 'success' }} mb-3"></i>
                                <div>
                                    <a href="/diabetes" class="btn btn-outline-primary">New Assessment</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <div class="form-section">
                    <form method="POST" action="/diabetes" id="diabetesForm">
                        <h5 class="mb-4 text-primary">Personal Information</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="age" class="form-label">Age (years)</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="age" name="age" min="1" max="120" required>
                                        <span class="input-group-text">yrs</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="pregnancies" class="form-label">Number of Pregnancies</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="pregnancies" name="pregnancies" min="0" max="20" required>
                                        <span class="input-group-text">times</span>
                                    </div>
                                    <small class="text-muted">Enter 0 if not applicable</small>
                                </div>
                            </div>
                        </div>
                        
                        <hr class="my-4">
                        
                        <h5 class="mb-4 text-primary">Health Metrics</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="glucose" class="form-label">
                                        Glucose Level 
                                        <i class="fas fa-info-circle info-icon" data-bs-toggle="tooltip" title="Plasma glucose concentration (mg/dL)"></i>
                                    </label>
                                    <div class="input-group">
                                        <input type="number" step="0.1" class="form-control" id="glucose" name="glucose" min="0" required>
                                        <span class="input-group-text">mg/dL</span>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="blood_pressure" class="form-label">
                                        Blood Pressure 
                                        <i class="fas fa-info-circle info-icon" data-bs-toggle="tooltip" title="Diastolic blood pressure (mm Hg)"></i>
                                    </label>
                                    <div class="input-group">
                                        <input type="number" step="0.1" class="form-control" id="blood_pressure" name="blood_pressure" min="0" required>
                                        <span class="input-group-text">mm Hg</span>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="skin_thickness" class="form-label">
                                        Skin Thickness 
                                        <i class="fas fa-info-circle info-icon" data-bs-toggle="tooltip" title="Triceps skin fold thickness (mm)"></i>
                                    </label>
                                    <div class="input-group">
                                        <input type="number" step="0.1" class="form-control" id="skin_thickness" name="skin_thickness" min="0" required>
                                        <span class="input-group-text">mm</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="insulin" class="form-label">
                                        Insulin Level 
                                        <i class="fas fa-info-circle info-icon" data-bs-toggle="tooltip" title="2-Hour serum insulin (mu U/ml)"></i>
                                    </label>
                                    <div class="input-group">
                                        <input type="number" step="0.1" class="form-control" id="insulin" name="insulin" min="0" required>
                                        <span class="input-group-text">mu U/ml</span>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="bmi" class="form-label">
                                        BMI 
                                        <i class="fas fa-info-circle info-icon" data-bs-toggle="tooltip" title="Body mass index (weight in kg / (height in m)^2)"></i>
                                    </label>
                                    <input type="number" step="0.1" class="form-control" id="bmi" name="bmi" min="0" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="diabetes_pedigree" class="form-label">
                                        Diabetes Pedigree Function 
                                        <i class="fas fa-info-circle info-icon" data-bs-toggle="tooltip" title="Diabetes pedigree function (indicates genetic influence)"></i>
                                    </label>
                                    <input type="number" step="0.001" class="form-control" id="diabetes_pedigree" name="diabetes_pedigree" min="0" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                            <button type="reset" class="btn btn-outline-secondary me-md-2">Reset</button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-calculator me-1"></i> Calculate Risk
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="card border-left-info mb-4">
                    <div class="card-body">
                        <h5 class="card-title text-info">
                            <i class="fas fa-lightbulb me-2"></i> Understanding Your Results
                        </h5>
                        <p class="card-text">
                            Our diabetes prediction model analyzes your health metrics against patterns learned from thousands of cases. 
                            A positive result suggests you may be at risk and should consult a healthcare professional. 
                            A negative result indicates lower risk but doesn't guarantee absence of diabetes.
                        </p>
                        <a href="#" class="btn btn-outline-info btn-sm">Learn more about diabetes</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function() {
        // Initialize tooltips
        $('[data-bs-toggle="tooltip"]').tooltip();
        
        // Example of dynamic help - could be expanded
        $('#bmi').on('focus', function() {
            $('#bmiHelp').fadeIn();
        }).on('blur', function() {
            $('#bmiHelp').fadeOut();
        });
        
        // Form validation
        $('#diabetesForm').on('submit', function() {
            let isValid = true;
            $(this).find('input[required]').each(function() {
                if (!$(this).val()) {
                    isValid = false;
                    $(this).addClass('is-invalid');
                } else {
                    $(this).removeClass('is-invalid');
                }
            });
            
            if (!isValid) {
                $('html, body').animate({
                    scrollTop: $('.is-invalid').first().offset().top - 100
                }, 500);
                return false;
            }
            return true;
        });
    });
</script>
{% endblock %}